create procedure Plex.accounting_balance_delete_period_range
(
	@pcn int
)
as
begin
	
	declare @start_period int;
	declare @end_period int;
	select @start_period=start_period,@end_period=end_period 
	from Plex.accounting_period_ranges where pcn = @pcn
--	SELECT @pcn pcn, @start_period start_period, @end_period end_period
	delete from Plex.accounting_balance WHERE pcn = @pcn and period between @start_period and @end_period	
end;

create procedure Plex.sp_max_fiscal_period
(
	@pcn int,
	@year int,
	@max_fiscal_period int output
)
as 
BEGIN

WITH fiscal_period(pcn,year,period)
as
(
	select pcn,year(begin_date) year,period 
	from Plex.accounting_period 
	where pcn = @pcn
	and year(begin_date) = @year 
)
-- select * from fiscal_period;
,max_fiscal_period(pcn,year,max_fiscal_period)
as
(
  SELECT pcn,year,max(period) max_fiscal_period
  FROM fiscal_period
  group by pcn,[year]
)
--select * from max_fiscal_period
select @max_fiscal_period = max_fiscal_period from max_fiscal_period;
	
end;

select *
from Plex.account_period_balance
where account_no in ('40060-000-0100','65100-100-0100','68400-000-0100')
and pcn = 123681 and period between 202401 and 202405
order by period, account_no


select *
from Plex.account_period_balance
where account_no in ('40060-000-0100','65100-100-0100','68400-000-0100')
and pcn = 123681 and period between 202401 and 202405
order by period, account_no


--INSERT INTO Plex.account_period_balance (pcn,account_no,period,period_display,debit,ytd_debit,credit,ytd_credit,balance,ytd_balance) VALUES
--	 (123681,N'40060-000-0100',202401,N'01-2024',0.00000,0.00000,0.00000,0.00000,0.00000,0.00000),
--	 (123681,N'65100-100-0100',202401,N'01-2024',0.00000,0.00000,0.00000,0.00000,0.00000,0.00000),
--	 (123681,N'68400-000-0100',202401,N'01-2024',0.00000,0.00000,0.00000,0.00000,0.00000,0.00000),
--	 (123681,N'40060-000-0100',202402,N'02-2024',0.00000,0.00000,0.00000,0.00000,0.00000,0.00000),
--	 (123681,N'65100-100-0100',202402,N'02-2024',0.00000,0.00000,0.00000,0.00000,0.00000,0.00000),
--	 (123681,N'68400-000-0100',202402,N'02-2024',0.00000,0.00000,0.00000,0.00000,0.00000,0.00000),
--	 (123681,N'40060-000-0100',202403,N'03-2024',0.00000,0.00000,0.00000,0.00000,0.00000,0.00000),
--	 (123681,N'65100-100-0100',202403,N'03-2024',0.00000,0.00000,0.00000,0.00000,0.00000,0.00000),
--	 (123681,N'68400-000-0100',202403,N'03-2024',0.00000,0.00000,0.00000,0.00000,0.00000,0.00000),
--	 (123681,N'40060-000-0100',202404,N'04-2024',0.00000,0.00000,0.00000,0.00000,0.00000,0.00000);
--INSERT INTO Plex.account_period_balance (pcn,account_no,period,period_display,debit,ytd_debit,credit,ytd_credit,balance,ytd_balance) VALUES
--	 (123681,N'65100-100-0100',202404,N'04-2024',0.00000,0.00000,0.00000,0.00000,0.00000,0.00000),
--	 (123681,N'68400-000-0100',202404,N'04-2024',0.00000,0.00000,0.00000,0.00000,0.00000,0.00000),
--	 (123681,N'40060-000-0100',202405,N'05-2024',0.00000,0.00000,0.00000,0.00000,0.00000,0.00000),
--	 (123681,N'65100-100-0100',202405,N'05-2024',0.00000,0.00000,0.00000,0.00000,0.00000,0.00000),
--	 (123681,N'68400-000-0100',202405,N'05-2024',0.00000,0.00000,0.00000,0.00000,0.00000,0.00000);


select *
from Plex.account_period_balance
where 
pcn = 123681 and period = 202405
and account_no in 
('11050-000-0070',
'11050-000-0315',
'17550-000-0000',
'20150-000-0070',
'20150-000-0315',
'63100-100-0070',
'63100-100-0315',
'65100-100-0070',
'65100-100-0315',
'68400-000-0070',
'68400-000-0315',
'68400-100-0070',
'68400-100-0315')
order by period, account_no

--INSERT INTO Plex.account_period_balance
--  (pcn,account_no,period,period_display,debit,ytd_debit,credit,ytd_credit,balance,ytd_balance)
--VALUES
--  (123681, N'11050-000-0070', 202405, N'05-2024', 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000),
--  (123681, N'11050-000-0315', 202405, N'05-2024', 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000),
--  (123681, N'17550-000-0000', 202405, N'05-2024', 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000),
--  (123681, N'20150-000-0070', 202405, N'05-2024', 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000),
--  (123681, N'20150-000-0315', 202405, N'05-2024', 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000),
--  (123681, N'63100-100-0070', 202405, N'05-2024', 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000),
--  (123681, N'63100-100-0315', 202405, N'05-2024', 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000),
--  (123681, N'65100-100-0070', 202405, N'05-2024', 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000),
--  (123681, N'65100-100-0315', 202405, N'05-2024', 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000),
--  (123681, N'68400-000-0070', 202405, N'05-2024', 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000);
--INSERT INTO Plex.account_period_balance
--  (pcn,account_no,period,period_display,debit,ytd_debit,credit,ytd_credit,balance,ytd_balance)
--VALUES
--  (123681, N'68400-000-0315', 202405, N'05-2024', 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000),
--  (123681, N'68400-100-0070', 202405, N'05-2024', 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000),
--  (123681, N'68400-100-0315', 202405, N'05-2024', 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000);
--
--INSERT INTO Plex.account_period_balance
--  (pcn,account_no,period,period_display,debit,ytd_debit,credit,ytd_credit,balance,ytd_balance)
--VALUES
--  (123681, N'11050-000-0070', 202404, N'04-2024', 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000),
--  (123681, N'11050-000-0315', 202404, N'04-2024', 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000),
--  (123681, N'17550-000-0000', 202404, N'04-2024', 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000),
--  (123681, N'20150-000-0070', 202404, N'04-2024', 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000),
--  (123681, N'20150-000-0315', 202404, N'04-2024', 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000),
--  (123681, N'63100-100-0070', 202404, N'04-2024', 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000),
--  (123681, N'63100-100-0315', 202404, N'04-2024', 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000),
--  (123681, N'65100-100-0070', 202404, N'04-2024', 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000),
--  (123681, N'65100-100-0315', 202404, N'04-2024', 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000),
--  (123681, N'68400-000-0070', 202404, N'04-2024', 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000);
--INSERT INTO Plex.account_period_balance
--  (pcn,account_no,period,period_display,debit,ytd_debit,credit,ytd_credit,balance,ytd_balance)
--VALUES
--  (123681, N'68400-000-0315', 202404, N'04-2024', 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000),
--  (123681, N'68400-100-0070', 202404, N'04-2024', 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000),
--  (123681, N'68400-100-0315', 202404, N'04-2024', 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000);
--
--
--INSERT INTO Plex.account_period_balance (pcn,account_no,period,period_display,debit,ytd_debit,credit,ytd_credit,balance,ytd_balance) VALUES
--         (123681,N'11050-000-0070',202403,N'03-2024',0.00000,0.00000,0.00000,0.00000,0.00000,0.00000),
--         (123681,N'11050-000-0315',202403,N'03-2024',0.00000,0.00000,0.00000,0.00000,0.00000,0.00000),
--         (123681,N'17550-000-0000',202403,N'03-2024',0.00000,0.00000,0.00000,0.00000,0.00000,0.00000),
--         (123681,N'20150-000-0070',202403,N'03-2024',0.00000,0.00000,0.00000,0.00000,0.00000,0.00000),
--         (123681,N'20150-000-0315',202403,N'03-2024',0.00000,0.00000,0.00000,0.00000,0.00000,0.00000),
--         (123681,N'63100-100-0070',202403,N'03-2024',0.00000,0.00000,0.00000,0.00000,0.00000,0.00000),
--         (123681,N'63100-100-0315',202403,N'03-2024',0.00000,0.00000,0.00000,0.00000,0.00000,0.00000),
--         (123681,N'65100-100-0070',202403,N'03-2024',0.00000,0.00000,0.00000,0.00000,0.00000,0.00000),
--         (123681,N'65100-100-0315',202403,N'03-2024',0.00000,0.00000,0.00000,0.00000,0.00000,0.00000),
--         (123681,N'68400-000-0070',202403,N'03-2024',0.00000,0.00000,0.00000,0.00000,0.00000,0.00000);
--INSERT INTO Plex.account_period_balance (pcn,account_no,period,period_display,debit,ytd_debit,credit,ytd_credit,balance,ytd_balance) VALUES
--         (123681,N'68400-000-0315',202403,N'03-2024',0.00000,0.00000,0.00000,0.00000,0.00000,0.00000),
--         (123681,N'68400-100-0070',202403,N'03-2024',0.00000,0.00000,0.00000,0.00000,0.00000,0.00000),
--         (123681,N'68400-100-0315',202403,N'03-2024',0.00000,0.00000,0.00000,0.00000,0.00000,0.00000);


select *
from Plex.account_period_balance
where 
pcn = 123681 and period = 202405
and account_no in 
(
         '11050-000-0309',
         '20150-000-0240',
         '20150-000-0309',
         '73000-200-0000',
         '73000-320-0000',
         '90400-000-0309'
)

--  INSERT INTO Plex.account_period_balance (pcn,account_no,period,period_display,debit,ytd_debit,credit,ytd_credit,balance,ytd_balance) VALUES
--         (123681,N'11050-000-0309',202405,N'05-2024',0.00000,0.00000,0.00000,0.00000,0.00000,0.00000),
--         (123681,N'20150-000-0240',202405,N'05-2024',0.00000,0.00000,0.00000,0.00000,0.00000,0.00000),
--         (123681,N'20150-000-0309',202405,N'05-2024',0.00000,0.00000,0.00000,0.00000,0.00000,0.00000),
--         (123681,N'73000-200-0000',202405,N'05-2024',0.00000,0.00000,0.00000,0.00000,0.00000,0.00000),
--         (123681,N'73000-320-0000',202405,N'05-2024',0.00000,0.00000,0.00000,0.00000,0.00000,0.00000),
--         (123681,N'90400-000-0309',202405,N'05-2024',0.00000,0.00000,0.00000,0.00000,0.00000,0.00000);
       